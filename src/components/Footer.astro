---
import logoWhite from '../assets/logo_logotype_white.svg';
import NewsletterForm from './NewsletterForm.astro';
import LanguageSwitcher from './LanguageSwitcher.astro';
import { useTranslations, getLocaleFromUrl } from '../i18n/utils.js';

interface Props {
  showNewsletter?: boolean;
  locale?: 'fr' | 'en';
}

const {
  showNewsletter = true
} = Astro.props;

const locale = getLocaleFromUrl(Astro.url.pathname);
const t = useTranslations(locale);
const currentYear = new Date().getFullYear();

// Get current path for language switcher
const currentPath = Astro.url.pathname;
---

<footer class="footer">
  <!-- Newsletter Section -->
  {showNewsletter && (
    <div class="newsletter-wrapper">
      <div class="container">
        <NewsletterForm variant="footer" locale={locale} />
      </div>
    </div>
  )}

  <!-- Main Footer -->
  <div class="footer-main">
    <div class="container">
      <div class="footer-content">
        <!-- Company Info -->
        <div class="footer-brand">
          <div class="brand-logo">
            <img 
              src={logoWhite.src}
              alt={t('hero.logoAlt')}
              width="120"
              height="40"
              loading="lazy"
            />
          </div>
          
          <p class="brand-description">
            {t('footer.description')}
          </p>
          
          <div class="social-links">
            <a 
              href="https://twitter.com/tatikati_app" 
              class="social-link" 
              aria-label={t('footer.socialLinks.twitter')}
              target="_blank"
              rel="noopener noreferrer"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M20 4C19.3 4.3 18.5 4.5 17.6 4.6C18.5 4.1 19.1 3.3 19.4 2.3C18.6 2.8 17.7 3.1 16.7 3.3C15.9 2.5 14.8 2 13.6 2C11.3 2 9.4 3.9 9.4 6.2C9.4 6.5 9.4 6.8 9.5 7.1C6.2 6.9 3.3 5.2 1.3 2.6C1 3.1 0.8 3.7 0.8 4.3C0.8 5.4 1.4 6.4 2.2 6.9C1.7 6.9 1.2 6.7 0.7 6.5V6.5C0.7 8.5 2.1 10.1 4 10.5C3.7 10.6 3.4 10.6 3 10.6C2.8 10.6 2.5 10.6 2.3 10.5C2.8 12.1 4.3 13.2 6.1 13.2C4.7 14.2 2.9 14.8 1 14.8H0.2C2 15.9 4.2 16.5 6.6 16.5C13.6 16.5 17.4 10.6 17.4 6.6V6.2C18.2 5.7 18.9 5 19.4 4.2L20 4Z"/>
              </svg>
            </a>
            
            <a 
              href="https://www.facebook.com/tatikati.app" 
              class="social-link" 
              aria-label={t('footer.socialLinks.facebook')}
              target="_blank"
              rel="noopener noreferrer"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M20 10C20 4.5 15.5 0 10 0S0 4.5 0 10C0 14.9 3.7 19.1 8.4 19.9V12.9H5.9V10H8.4V7.8C8.4 5.3 9.9 3.9 12.2 3.9C13.3 3.9 14.5 4.1 14.5 4.1V6.6H13.2C11.9 6.6 11.5 7.4 11.5 8.2V10H14.4L13.9 12.9H11.5V19.9C16.3 19.1 20 14.9 20 10Z"/>
              </svg>
            </a>
            
            <a 
              href="https://www.instagram.com/tatikati_app" 
              class="social-link" 
              aria-label={t('footer.socialLinks.instagram')}
              target="_blank"
              rel="noopener noreferrer"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 2C7.8 2 7.5 2 6.5 2C5.5 2 4.8 2.2 4.2 2.4C3.5 2.7 3 3 2.6 3.4C2.2 3.8 1.9 4.3 1.6 5C1.4 5.6 1.2 6.3 1.2 7.3C1.2 8.3 1.2 8.6 1.2 10.8C1.2 13 1.2 13.3 1.2 14.3C1.2 15.3 1.4 16 1.6 16.6C1.9 17.3 2.2 17.8 2.6 18.2C3 18.6 3.5 18.9 4.2 19.2C4.8 19.4 5.5 19.6 6.5 19.6C7.5 19.6 7.8 19.6 10 19.6C12.2 19.6 12.5 19.6 13.5 19.6C14.5 19.6 15.2 19.4 15.8 19.2C16.5 18.9 17 18.6 17.4 18.2C17.8 17.8 18.1 17.3 18.4 16.6C18.6 16 18.8 15.3 18.8 14.3C18.8 13.3 18.8 13 18.8 10.8C18.8 8.6 18.8 8.3 18.8 7.3C18.8 6.3 18.6 5.6 18.4 5C18.1 4.3 17.8 3.8 17.4 3.4C17 3 16.5 2.7 15.8 2.4C15.2 2.2 14.5 2 13.5 2C12.5 2 12.2 2 10 2ZM10 4.3C12.1 4.3 12.4 4.3 13.3 4.3C14.2 4.3 14.7 4.5 15 4.6C15.4 4.8 15.7 4.9 16 5.2C16.3 5.5 16.4 5.8 16.6 6.2C16.7 6.5 16.9 7 16.9 7.9C16.9 8.8 16.9 9.1 16.9 11.2C16.9 13.3 16.9 13.6 16.9 14.5C16.9 15.4 16.7 15.9 16.6 16.2C16.4 16.6 16.3 16.9 16 17.2C15.7 17.5 15.4 17.6 15 17.8C14.7 17.9 14.2 18.1 13.3 18.1C12.4 18.1 12.1 18.1 10 18.1C7.9 18.1 7.6 18.1 6.7 18.1C5.8 18.1 5.3 17.9 5 17.8C4.6 17.6 4.3 17.5 4 17.2C3.7 16.9 3.6 16.6 3.4 16.2C3.3 15.9 3.1 15.4 3.1 14.5C3.1 13.6 3.1 13.3 3.1 11.2C3.1 9.1 3.1 8.8 3.1 7.9C3.1 7 3.3 6.5 3.4 6.2C3.6 5.8 3.7 5.5 4 5.2C4.3 4.9 4.6 4.8 5 4.6C5.3 4.5 5.8 4.3 6.7 4.3C7.6 4.3 7.9 4.3 10 4.3Z"/>
                <circle cx="10" cy="10" r="3.2"/>
                <circle cx="13.4" cy="6.6" r="0.7"/>
              </svg>
            </a>
            
            <a 
              href="https://www.linkedin.com/company/tatikati" 
              class="social-link" 
              aria-label={t('footer.socialLinks.linkedin')}
              target="_blank"
              rel="noopener noreferrer"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M18.7 0H1.3C0.6 0 0 0.6 0 1.3V18.7C0 19.4 0.6 20 1.3 20H18.7C19.4 20 20 19.4 20 18.7V1.3C20 0.6 19.4 0 18.7 0ZM6 17H3V8H6V17ZM4.5 6.7C3.5 6.7 2.7 5.9 2.7 4.9C2.7 3.9 3.5 3.1 4.5 3.1C5.5 3.1 6.3 3.9 6.3 4.9C6.3 5.9 5.5 6.7 4.5 6.7ZM17 17H14V12.7C14 11.6 14 10.2 12.5 10.2C11 10.2 10.8 11.4 10.8 12.6V17H7.8V8H10.7V9.3C11.1 8.6 12 7.8 13.4 7.8C16.4 7.8 17 9.7 17 12.2V17Z"/>
              </svg>
            </a>
          </div>
        </div>
        
        <!-- Navigation Links -->
        <div class="footer-nav">
          <div class="nav-group">
            <h4 class="nav-title">{t('footer.nav.product')}</h4>
            <ul class="nav-list">
              <li><a href="#features">{t('footer.links.features')}</a></li>
              <li><a href="#podcasts">{t('footer.links.podcasts')}</a></li>
              <li><a href="#download">{t('footer.links.download')}</a></li>
            </ul>
          </div>
          
          <div class="nav-group">
            <h4 class="nav-title">{t('footer.nav.resources')}</h4>
            <ul class="nav-list">
              <li><a href={locale === 'fr' ? '/blog' : '/en/blog'}>{t('footer.links.blog')}</a></li>
              <li><a href="#faq">{t('footer.links.faq')}</a></li>
              <li><a href={locale === 'fr' ? '/support' : '/en/support'}>{t('footer.links.support')}</a></li>
            </ul>
          </div>
          
          <div class="nav-group">
            <h4 class="nav-title">{t('footer.nav.company')}</h4>
            <ul class="nav-list">
              <li><a href={locale === 'fr' ? '/about' : '/en/about'}>{t('footer.links.about')}</a></li>
              <li><a href={locale === 'fr' ? '/contact' : '/en/contact'}>{t('footer.links.contact')}</a></li>
              <li><a href={locale === 'fr' ? '/press' : '/en/press'}>{t('footer.links.press')}</a></li>
            </ul>
          </div>
          
          <div class="nav-group">
            <h4 class="nav-title">{t('footer.nav.legal')}</h4>
            <ul class="nav-list">
              <li><a href={locale === 'fr' ? '/privacy' : '/en/privacy'}>{t('footer.links.privacy')}</a></li>
              <li><a href={locale === 'fr' ? '/terms' : '/en/terms'}>{t('footer.links.terms')}</a></li>
              <li><a href={locale === 'fr' ? '/cookies' : '/en/cookies'}>{t('footer.links.cookies')}</a></li>
              <li><a href={locale === 'fr' ? '/legal' : '/en/legal'}>{t('footer.links.legal')}</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Footer Bottom -->
  <div class="footer-bottom">
    <div class="container">
      <div class="bottom-content">
        <div class="bottom-left">
          <p class="copyright">
            Â© {currentYear} Tatikati. {t('footer.copyright')}
            {t('footer.madeWith')}
          </p>
        </div>

        <div class="bottom-center">
          <div class="footer-badges">
            <div class="badge-item">
              <span class="badge-text">{t('footer.badges.french')}</span>
            </div>
            <div class="badge-item">
              <span class="badge-text">{t('footer.badges.gdpr')}</span>
            </div>
            <div class="badge-item">
              <span class="badge-text">{t('footer.badges.accessible')}</span>
            </div>
          </div>
        </div>

        <div class="bottom-right">
          <LanguageSwitcher locale={locale} currentPath={currentPath} />
        </div>
      </div>
    </div>
  </div>
</footer>

<style>
  .footer {
    background: var(--color-fg);
    color: var(--color-bg);
    margin-top: auto;
  }

  /* Newsletter Section */
  .newsletter-wrapper {
    background: linear-gradient(135deg, var(--color-accent-1), var(--color-accent-3));
    padding: var(--space-3xl) 0;
    color: white;
  }

  /* Main Footer */
  .footer-main {
    padding: var(--space-4xl) 0 var(--space-2xl);
  }

  .footer-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-3xl);
  }

  /* Brand Section */
  .footer-brand {
    max-width: 400px;
  }

  .brand-logo {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-lg);
  }

  .brand-name {
    font-family: var(--font-heading);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-bg);
  }

  .brand-description {
    color: var(--color-gray-400);
    line-height: 1.6;
    margin-bottom: var(--space-xl);
  }

  .social-links {
    display: flex;
    gap: var(--space-md);
  }

  .social-link {
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-gray-400);
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .social-link:hover {
    background: var(--color-accent-1);
    color: white;
    transform: translateY(-2px);
  }

  /* Navigation */
  .footer-nav {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--space-lg);
  }

  .nav-title {
    font-family: var(--font-heading);
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-bg);
    margin-bottom: var(--space-lg);
  }

  .nav-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .nav-list li {
    margin-bottom: var(--space-sm);
  }

  .nav-list a {
    color: var(--color-gray-400);
    text-decoration: none;
    font-size: 0.9rem;
    transition: color 0.2s ease;
  }

  .nav-list a:hover {
    color: var(--color-accent-1);
  }

  /* Footer Bottom */
  .footer-bottom {
    padding: var(--space-xl) 0;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .bottom-content {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: var(--space-lg);
  }

  .bottom-left {
    justify-self: start;
  }

  .bottom-center {
    justify-self: center;
  }

  .bottom-right {
    justify-self: end;
  }

  .copyright {
    color: var(--color-gray-400);
    font-size: 0.9rem;
    margin: 0;
  }

  .footer-badges {
    display: flex;
    gap: var(--space-lg);
    flex-wrap: wrap;
  }

  .badge-text {
    font-size: 0.85rem;
    color: var(--color-gray-400);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }

  /* Responsive Design */
  @media (min-width: 768px) {
    .footer-content {
      grid-template-columns: 1fr 2fr;
    }
  }

  @media (max-width: 1024px) {
    .bottom-content {
      grid-template-columns: 1fr;
      justify-items: center;
      text-align: center;
      gap: var(--space-md);
    }

    .bottom-left,
    .bottom-center, 
    .bottom-right {
      justify-self: center;
    }
  }

  @media (max-width: 767px) {
    .footer-nav {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-md);
    }

    .footer-badges {
      justify-content: center;
      gap: var(--space-md);
    }
  }

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    .social-link {
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .footer-bottom {
      border-top: 2px solid rgba(255, 255, 255, 0.3);
    }
  }

  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    .social-link {
      transition: none;
    }

    .social-link:hover {
      transform: none;
    }
  }

  /* Screen Reader Only */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {

    // Social links analytics
    const socialLinks = document.querySelectorAll('.social-link');
    socialLinks.forEach(link => {
      link.addEventListener('click', function() {
        const platform = this.getAttribute('aria-label').split(' ').pop().toLowerCase();
        console.log('Social link clicked:', platform);
        // Example: gtag('event', 'social_click', { platform: platform });
      });
    });

    // Footer navigation analytics
    const footerLinks = document.querySelectorAll('.nav-list a');
    footerLinks.forEach(link => {
      link.addEventListener('click', function() {
        const linkText = this.textContent.trim();
        const section = this.closest('.nav-group').querySelector('.nav-title').textContent;
        console.log('Footer navigation:', { section, link: linkText });
      });
    });

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  });
</script>